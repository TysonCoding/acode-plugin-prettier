!function(){"use strict";var e={m:{},u:function(e){return e+".js"}};e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),e.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){var t;e.g.importScripts&&(t=e.g.location+"");var r=e.g.document;if(!t&&r&&(r.currentScript&&(t=r.currentScript.src),!t)){var n=r.getElementsByTagName("script");if(n.length)for(var s=n.length-1;s>-1&&!t;)t=n[s--].src}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),e.p=t}(),e.b=document.baseURI||self.location.href;var t=JSON.parse('{"id":"acode.plugin.prettier"}');function r(e,t){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.add(e)}function n(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function s(e,t,r){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return r}const i=t.id,o=acode.require("settings");var a=new WeakSet,c=new WeakSet,l=new WeakSet,u=new WeakSet;class d{constructor(){r(this,u),r(this,l),r(this,c),r(this,a),n(this,"worker",null),n(this,"workerInitialized",!1),this.run=this.run.bind(this)}async loadScript(){if(document.getElementById("prettier-vendor-script"))return;const e=document.createElement("script");return e.id="prettier-vendor-script",e.src=acode.joinUrl(this.baseUrl,"vendor.js"),new Promise(((t,r)=>{e.onload=t,e.onerror=r}))}static inferParser(e){switch(e.slice(e.lastIndexOf(".")+1)){case"html":case"htm":return"html";case"css":return"css";case"scss":return"scss";case"less":return"less";case"js":case"cjs":case"es":case"mjs":case"jsx":return"babel";case"ts":case"tsx":return"typescript";case"vue":return"vue";case"json":return"json";case"hbs":case"handlebars":return"glimmer";case"md":return"markdown";case"yaml":case"yml":return"yaml";default:return null}}async init(){"undefined"!=typeof Worker?s(this,l,p).call(this):await this.loadScript(),acode.registerFormatter(i,["html","htm","css","scss","less","js","cjs","es","mjs","jsx","ts","tsx","vue","json","hbs","handlebars","md","yaml","yml"],this.run)}async run(){const{editor:e,activeFile:t}=editorManager,{session:r}=t,n=e.getValue(),i=e.getCursorPosition(),c={parser:d.inferParser(t.name),cursorOffset:s(this,a,h).call(this,i),filepath:t.name,tabWidth:o.value.tabSize};if("undefined"!=typeof Worker)return void this.worker.postMessage({id:t.id,code:n,cursorOptions:c});const{prettier:l,plugins:f}=window.acodePluginPrettier;c.plugins=f;const p=l.formatWithCursor(n,c);s(this,u,m).call(this,r,p)}destroy(){acode.unregisterFormatter(t.id)}}function h(e){let{row:t,column:r}=e;const{editor:n}=editorManager,s=n.getValue().split("\n");for(let e=0;e<t-1;e++)r+=s[e].length;return r}function f(e){const{editor:t}=editorManager,r=t.getValue().split("\n");let n=0,s=0;for(let t=0;t<r.length;t++){if(s+r[t].length>=e){n=t,s=e-s;break}s+=r[t].length}return{row:n,column:s}}function p(){this.worker=new Worker(new URL(e.p+e.u(744),e.b)),this.worker.onmessage=e=>{const{id:t,res:r,action:n}=e.data;if("script loaded"!==n){if("code format"===n){const e=editorManager.getFile(t,"id");if(!e)return;const{session:n}=e;s(this,u,m).call(this,n,r)}}else this.workerInitialized=!0},this.worker.postMessage({action:"load script",scriptUrl:acode.joinUrl(this.baseUrl,"vendor.js")})}function m(e,t){const{$undoStack:r,$redoStack:n,$rev:i,$mark:o}=Object.assign({},e.getUndoManager());e.setValue(t.formatted);const a=e.getUndoManager();a.$undoStack=r,a.$redoStack=n,a.$rev=i,a.$mark=o;const{row:l,column:u}=s(this,c,f).call(this,t.cursorOffset);e.selection.moveCursorTo(l,u)}if(window.acode){const e=new d;acode.setPluginInit(i,((t,r,n)=>{let{cacheFileUrl:s,cacheFile:i}=n;t.endsWith("/")||(t+="/"),e.baseUrl=t,e.init(r,i,s)})),acode.setPluginUnmount(i,(()=>{e.destroy()}))}}();